#!/usr/bin/env bash

echo "updating vim"

git clone --depth 1 https://github.com/wbthomason/packer.nvim \
     ~/.local/share/nvim/site/pack/packer/start/packer.nvim

echo "upgrading vim-packer"
nvim --headless -c 'autocmd User PackerComplete quitall' -c 'PackerSync'

# echo "Installing some coc-plugins..."
# $EDITOR +CocInstall coc-java coc-json coc-go coc-typescript -c qa

echo "updating kitty things"
if command -v kitty
then
    # https://sw.kovidgoyal.net/kitty/faq.html#i-get-errors-about-the-terminal-being-unknown-or-opening-the-terminal-failing-when-sshing-into-a-different-computer
    infocmp xterm-kitty > temp-xterm-kitty.temp
    tic -x -o ~/.config/kitty/terminfo/ temp-xterm-kitty.temp
    rm temp-xterm-kitty.temp
fi

echo "Installing java"
nix build nixpkgs#jdk8 -o ~/.local/lib/jdk8
nix build nixpkgs#jdk11 -o ~/.local/lib/jdk11
nix build nixpkgs#jdk17 -o ~/.local/lib/jdk17

if [[ ! -f ~/.local/bin/jdtls ]]
then
    echo 'installing jdtls'
    curl https://raw.githubusercontent.com/eruizc-dev/jdtls-launcher/master/install.sh | bash
fi

echo 'updating jdtls'
jdtls --update
